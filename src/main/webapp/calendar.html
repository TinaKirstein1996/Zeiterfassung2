<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Zeiterfassungs Kalender</title>

<link rel="stylesheet" href = "css/calendarStyle.css">
<link rel="stylesheet" href = "js/fullcalendar/lib/main.css">

<script src="js/sweetalert2.all.min.js" defer></script>
<script src="js/fullcalendar/lib/main.js" defer></script>

<script> 
document.addEventListener('DOMContentLoaded', function() {
	var calendarEl = document.getElementById('calendar');
	var calendar = new FullCalendar.Calendar(calendarEl, {
		initialView: 'dayGridMonth',
		height: 650,
		events: 'fetchEvents.php',
		
		selectable: true,
		select: async function (start, end, allDay) {
			const { value: formValues } = await Swal.fire({
				title: 'Add Event',
				html: '<input id="swalEvtTitle" class="swal2-input" placeholder="Enter title">' + 
				'<textarea id = "swalEvtDesc" class="swal2-input" placeholder="Enter Description"></textarea>' +
				'<input id = "swalEvtURL" class="swal2-input" placeholder="Enter URL">',
				focusConfirm: false,
				preConfirm: () => {
					return [
						document.getElementById('swalEvtTitle').value,
						document.getElementById('swalEvtDesc').value,
						document.getElementById('swalEvtURL').value,
					]
				}
				
			});
			
			if (formValues) {
				fetch("eventHandler.php", {
					method: "POST",
					headers: {"Content-Type": "application/json" },
					body: JSON.stringify({ request_type:'addEvent', start:start.startStr, end:start.endStr, eventData:formValues}),
				})
				.then(response => response.json())
				.then(data => {
					if (data.status == 1) {
						Swal.fire('Arbeitszeit erfolgreich erfasst!', '', 'success');
					} else {
						Swal.fire(data.error, '', 'error');
					}
					
					calendar.refetchEvents();
				})
				.catch(console.error);
			}
		},
		
		eventClick: function(info) {
			info.jsEvent.preventDefault();
			
			info.el.style.borderColor = 'red';
			
			Swal.fire({
				title: 'Beginn: '+info.event.extendedProps.start_time+'<br> Ende: '+info.event.extendedProps.end_time+'<br> Pause: '+info.event.extendedProps.pause_time+'<br> Notiz: '+info.event.extendedProps.note,
				icon: 'info',
				
			})
			
		}
	});
	calendar.render();
});
</script>
</head>

<body>
<div class = "container">
	<div class= "wrapper">
		<div id= "calendar"></div>
	</div>
</div>
</body>
</html>